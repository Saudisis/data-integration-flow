<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AQA Data Integration Pipeline ‚Äî Interactive Workflow</title>

<!-- Mermaid cl√°sico (no ES module) -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
  // Inicializa Mermaid al cargar la p√°gina
  mermaid.initialize({
    startOnLoad: true,
    theme: "default",
    securityLevel: "loose"   // permite saltos de l√≠nea/HTML simple en labels
  });
</script>

<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#fff;color:#111827;margin:0}
  header{background:#f8fafc;border-bottom:1px solid #e2e8f0;padding:1.5rem;text-align:center}
  h1{margin:0;font-size:1.8rem}
  p{margin:.4rem 0 0;color:#64748b}
  .wrap{max-width:1100px;margin:0 auto;padding:20px}
  .mermaid{margin:24px auto;max-width:100%}
  footer{padding:1rem;text-align:center;color:#64748b;background:#f9fafb;border-top:1px solid #e5e7eb}
</style>
</head>
<body>
  <header>
    <h1>üåç AQA Data Integration Pipeline</h1>
    <p>Interactive Workflow ‚Äî ARPA + ERA5 Integration</p>
  </header>

  <div class="wrap">
    <!-- Diagrama Mermaid embebido -->
    <div class="mermaid">
flowchart TD
  A1[User Configuration<br/>(cfg: dates, time windows, bbox, vars)]
  A2[ARPA Lombardia API]
  A3[ERA5 CDS API]

  B1[Load ARPA Metadata<br/>Sensors ‚Ä¢ Coordinates ‚Ä¢ Pollutants]
  B2[Download ARPA Measurements<br/>Daily loop ‚Ä¢ Main/Backup endpoints<br/>Merge with metadata]
  B3[Download ERA5 Variables<br/>Loop variables ‚Üí .nc files]
  B4[Merge ERA5 Files<br/>Combine NetCDF ‚Üí DataFrame (xarray)]
  B5[Build Spatial Grid<br/>Min sensor distance ‚Üí grid in bbox]
  B6[Interpolate ERA5 on Grid<br/>Bilinear interpolation]
  B7[Compute Period Means<br/>Classify hours prev/curr ‚Ä¢ aggregate]
  B8[Merge ERA5 + ARPA<br/>Nearest join ‚Ä¢ enrich sensors]

  C1[Integrated Dataset (ARPA + ERA5)]
  C2[Summary CSV + GeoDataFrame]
  C3[Visualization / GEE upload]

  %% Flujos
  A1 --> B1
  B1 --> B2
  A2 --> B2
  A1 --> B3
  A3 --> B3
  B3 --> B4
  B1 --> B5
  B4 --> B6
  B5 --> B6
  B2 --> B7
  B6 --> B8
  B7 --> B8
  B8 --> C1 --> C2 --> C3
    </div>
  </div>

  <footer>¬© 2025 Saudisis ‚Äî Mermaid.js on GitHub Pages</footer>
</body>
</html>
