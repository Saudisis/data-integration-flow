<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AQA Data Integration Pipeline</title>
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs" type="module"></script>
<script type="module">
  import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
  mermaid.initialize({ startOnLoad: true, theme: "default" });
</script>
<style>
body { font-family: system-ui, sans-serif; margin:0; background:#fff; color:#111; }
header { background:#f3f4f6; text-align:center; padding:1.5rem; border-bottom:1px solid #ddd; }
nav { background:#e5e7eb; padding:10px; display:flex; justify-content:center; flex-wrap:wrap; gap:10px; }
nav a { color:#1d4ed8; text-decoration:none; font-weight:600; }
.container { max-width:1100px; margin:auto; padding:2rem; }
.mermaid { margin:30px 0; }
h2 { border-bottom:2px solid #eee; padding-bottom:5px; }
footer { text-align:center; color:#666; padding:1rem; border-top:1px solid #eee; }
</style>
</head>
<body>

<header>
  <h1>üåç AQA Data Integration Pipeline</h1>
  <p>Interactive Workflow ‚Äî ARPA + ERA5 + Sentinel-5P</p>
</header>

<nav>
  <a href="#bpmn">BPMN</a>
  <a href="#er">ER</a>
  <a href="#block">Architecture</a>
  <a href="#uml">UML</a>
  <a href="#ux">UX Flow</a>
  <a href="#pipeline">Pipeline</a>
  <a href="#architecture">Computational</a>
  <a href="#integration">Integration</a>
  <a href="#output">Output</a>
  <a href="#tools">Tools</a>
</nav>

<div class="container">

<!-- 1. BPMN -->
<h2 id="bpmn">1Ô∏è‚É£ BPMN Process Diagram</h2>
<div class="mermaid">
flowchart TD
    U1([Set Parameters])
    U2([Trigger Download])
    S1([Load ARPA Metadata])
    S2([Download ARPA Data])
    S3([Download ERA5 Data])
    S4([Download Sentinel-5P])
    S5([Merge and Harmonize])
    S6([Compute Means])
    S7([Export Integrated Dataset])
    U1 --> S1 --> S2 --> S3 --> S4 --> S5 --> S6 --> S7
</div>

<!-- 2. ER -->
<h2 id="er">2Ô∏è‚É£ Entity‚ÄìRelationship Diagram</h2>
<div class="mermaid">
erDiagram
    CONFIG ||--o{ ARPA_SENSOR : defines
    ARPA_SENSOR ||--o{ ARPA_MEASUREMENT : records
    CONFIG ||--o{ ERA5_FILE : triggers
    ERA5_FILE ||--o{ ERA5_VARIABLE : contains
    ERA5_VARIABLE }o--|| GRID_POINT : located_on
    SENTINEL_OBSERVATION }o--|| GRID_POINT : observed_at
    SUMMARY }o--|| GRID_POINT : summarized_at
</div>

<!-- 3. Block -->
<h2 id="block">3Ô∏è‚É£ Block Architecture Diagram</h2>
<div class="mermaid">
graph TD
    A[User Interface Layer] --> B[Data Acquisition Layer]
    B --> C[Processing Layer]
    C --> D[Storage Layer]
    D --> E[Visualization Layer]
    B1[ARPA Lombardia API]:::b
    B2[ERA5 CDS API]:::b
    B3[Sentinel-5P GEE]:::b
    style B1 fill:#dbeafe,stroke:#2563eb
    style B2 fill:#dbeafe,stroke:#2563eb
    style B3 fill:#dbeafe,stroke:#2563eb
</div>

<!-- 4. UML -->
<h2 id="uml">4Ô∏è‚É£ UML Use Case Diagram</h2>
<div class="mermaid">
graph TD
    Researcher --> (Configure Analysis)
    Researcher --> (Download Data)
    Researcher --> (Analyze Results)
    Researcher --> (Export Dataset)
    API[(ARPA/ERA5/Sentinel APIs)] --> (Provide Data)
    (Download Data) --> (Merge and Harmonize)
    (Merge and Harmonize) --> (Generate Outputs)
</div>

<!-- 5. UX -->
<h2 id="ux">5Ô∏è‚É£ UX / User Flow</h2>
<div class="mermaid">
flowchart TD
    A1[Start Notebook/App] --> A2[Select Province & Pollutant]
    A2 --> A3[Click "Download Data"]
    A3 --> A4[Wait for Success]
    A4 --> A5[Click "Analyze"]
    A5 --> A6[Show Results + Map]
    A6 --> A7[Export CSV/GeoPackage]
    A7 --> A8[Upload to GEE]
</div>

<!-- 6. Pipeline -->
<h2 id="pipeline">6Ô∏è‚É£ Pipeline Data Flow</h2>
<div class="mermaid">
graph LR
    A1[ARPA Metadata] --> B1[Sensor Catalog]
    A2[ERA5 .nc Files] --> B2[ERA5 Variables]
    A3[Sentinel-5P Rasters] --> B3[Pollutant Data]
    B1 --> C[Integration]
    B2 --> C
    B3 --> C
    C --> D[Unified DataFrame]
    D --> E[CSV/GeoDataFrame Export]
</div>

<!-- 7. Computational -->
<h2 id="architecture">7Ô∏è‚É£ Computational Architecture</h2>
<div class="mermaid">
graph TD
    J[Jupyter / Anaconda] --> P[Python Environment]
    P --> pandas
    P --> geopandas
    P --> xarray
    P --> cdsapi
    P --> earthengine
    P --> contextily
    pandas --> ARPA
    xarray --> ERA5
    earthengine --> Sentinel
    ARPA & ERA5 & Sentinel --> Merge
    Merge --> Results
</div>

<!-- 8. Integration -->
<h2 id="integration">8Ô∏è‚É£ Integration and Interpolation Logic</h2>
<div class="mermaid">
flowchart TD
    E1[ERA5 Variables] --> E2[ERA5 Dataset]
    E2 --> E3[Interpolate to ARPA Grid]
    E3 --> E4[ERA5 Interpolated Table]
    S1[Sentinel-5P Observations] --> S2[Daily Mean Extraction]
    S2 --> S3[Spatial Join with ARPA Grid]
    E4 & S3 --> F[Integrated ERA5 + Sentinel + ARPA Dataset]
</div>

<!-- 9. Output -->
<h2 id="output">9Ô∏è‚É£ Output Data Model</h2>
<div class="mermaid">
classDiagram
    class IntegratedDataset {
        int grid_id
        float lat
        float lon
        string pollutant
        float prev_mean
        float curr_mean
        float sentinel_no2
        float sentinel_co
        float sentinel_o3
        float sentinel_so2
        float t2m_c
        float sp_hpa
        float wind_speed
        float blh_km
        float tp
        float ssr_kJ
        string province
        date date
    }
</div>

<!-- 10. Tools -->
<h2 id="tools">üîü Tools Summary</h2>
<div class="mermaid">
graph LR
    A[Data APIs] -->|Fetch| B[ARPA / ERA5 / Sentinel]
    B -->|Process| C[Python Environment]
    C -->|Store| D[results/ Folder]
    D -->|Visualize| E[Jupyter / Web Maps]
    E -->|Publish| F[GitHub Pages / Reports]
</div>

</div>
<footer>
  ¬© 2025 AQA Integration Pipeline ‚Äî ARPA + ERA5 + Sentinel-5P
</footer>

</body>
</html>
