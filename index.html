<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AQA Data Integration Pipeline</title>

<!-- ✅ use the classic non-module version -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: "default",
    securityLevel: "loose"
  });
</script>

<style>
body {
  font-family: system-ui, sans-serif;
  margin: 0;
  background: #fff;
  color: #111;
}
header {
  background: #f3f4f6;
  text-align: center;
  padding: 1.5rem;
  border-bottom: 1px solid #ddd;
}
nav {
  background: #e5e7eb;
  padding: 10px;
  text-align: center;
}
nav a {
  margin: 0 8px;
  text-decoration: none;
  color: #1d4ed8;
  font-weight: 600;
}
.container {
  max-width: 1100px;
  margin: auto;
  padding: 2rem;
}
.mermaid {
  margin: 40px 0;
}
h2 {
  border-bottom: 2px solid #eee;
  padding-bottom: 5px;
}
footer {
  text-align: center;
  color: #666;
  padding: 1rem;
  border-top: 1px solid #eee;
}
</style>
</head>

<body>
<header>
  <h1> AQA Data Integration Pipeline</h1>
  <p>Interactive Workflow — ARPA + ERA5 + Sentinel-5P</p>
</header>

<nav>
  <a href="#bpmn">BPMN</a>
  <a href="#er">ER</a>
  <a href="#block">Architecture</a>
  <a href="#uml">UML</a>
  <a href="#ux">UX</a>
  <a href="#pipeline">Pipeline</a>
  <a href="#integration">Integration</a>
  <a href="#output">Output</a>
  <a href="#tools">Tools</a>
</nav>

<div class="container">

<h2 id="bpmn">1️⃣ BPMN Process</h2>
<div class="mermaid">
flowchart TD
    A1([Set Parameters]) --> A2([Load ARPA Metadata])
    A2 --> A3([Download ARPA Measurements])
    A3 --> A4([Download ERA5 Data])
    A4 --> A5([Download Sentinel-5P])
    A5 --> A6([Merge + Harmonize])
    A6 --> A7([Compute Period Means])
    A7 --> A8([Export Integrated Dataset])
</div>

<h2 id="er">2️⃣ ER Diagram</h2>
<div class="mermaid">
erDiagram
    CONFIG ||--o{ ARPA_SENSOR : defines
    ARPA_SENSOR ||--o{ ARPA_MEASUREMENT : records
    CONFIG ||--o{ ERA5_FILE : triggers
    ERA5_FILE ||--o{ ERA5_VARIABLE : contains
    ERA5_VARIABLE }o--|| GRID_POINT : located_on
    SENTINEL_OBSERVATION }o--|| GRID_POINT : observed_at
    SUMMARY }o--|| GRID_POINT : summarized_at
</div>

<h2 id="block">3️⃣ Block Architecture</h2>
<div class="mermaid">
graph TD
    UI[User Interface] --> ACQ[Data Acquisition]
    ACQ --> PROC[Processing]
    PROC --> STORE[Storage]
    STORE --> VIS[Visualization]
    ACQ1[ARPA API] --> ACQ
    ACQ2[ERA5 CDS API] --> ACQ
    ACQ3[Sentinel-5P GEE] --> ACQ
</div>

<h2 id="uml">4️⃣ UML Use Case</h2>
<div class="mermaid">
%%{init: {'theme': 'default'}}%%
flowchart TD
    %% Define actors
    R([Researcher])
    API([External API])

    %% Use cases
    UC1([Configure Analysis])
    UC2([Download Data])
    UC3([Analyze Results])
    UC4([Export Dataset])
    UC5([Provide Data])
    UC6([Merge and Harmonize])
    UC7([Generate Outputs])

    %% Relationships
    R --> UC1
    R --> UC2
    R --> UC3
    R --> UC4
    API --> UC5
    UC2 --> UC6
    UC6 --> UC7
</div>


<h2 id="ux">5️⃣ UX / User Flow</h2>
<div class="mermaid">
flowchart TD
    Start["User selects date range and AOI"]
    Config["System sets start_date and end_date"]
    Province["User selects Province and Pollutant"]
    Download["System downloads ARPA + ERA5 + Sentinel data"]
    Merge["Pipeline merges all datasets into unified grid"]
    Analyze["Compute current and previous daily means"]
    Export["Generate summary CSV + GeoDataFrame"]
    Visualize["Display map and charts or send to GEE"]

    Start --> Config
    Config --> Province
    Province --> Download
    Download --> Merge
    Merge --> Analyze
    Analyze --> Export
    Export --> Visualize
    Visualize --> End["User ready to explore results"]
</div>


<h2 id="pipeline">6️⃣ Pipeline Data Flow</h2>
<div class="mermaid">
graph LR
    A[ARPA Metadata] --> B[Sensor Catalog]
    C[ERA5 Files] --> D[ERA5 Variables]
    E[Sentinel-5P] --> F[Pollutant Maps]
    B --> G[Integration]
    D --> G
    F --> G
    G --> H[Unified Dataset]
    H --> I[Export CSV/GeoDataFrame]
</div>

<h2 id="integration">7️⃣ Integration & Interpolation</h2>
<div class="mermaid">
flowchart TD
    ERA1[ERA5 Variables] --> ERA2[Interpolate on Grid]
    ERA2 --> ERA3[ERA5 Interpolated Table]
    S1[Sentinel-5P Data] --> S2[Daily Mean]
    S2 --> S3[Join with Grid]
    ERA3 & S3 --> F[Integrated ERA5 + Sentinel + ARPA]
</div>

<h2 id="output">8️⃣ Output Data Model</h2>
<div class="mermaid">
classDiagram
    class IntegratedDataset {
        int grid_id
        float lat
        float lon
        string pollutant
        float prev_mean
        float curr_mean
        float sentinel_no2
        float sentinel_co
        float t2m_c
        float sp_hpa
        float wind_speed
        float blh_km
        float tp
        date date
    }
</div>

<h2 id="tools">9️⃣ Tools Summary</h2>
<div class="mermaid">
graph LR
    A[APIs] -->|Fetch| B[Python Scripts]
    B -->|Process| C[DataFrame]
    C -->|Store| D[results/ Folder]
    D -->|Visualize| E[Jupyter / GEE]
    E -->|Publish| F[GitHub Pages]
</div>

</div>
<footer>© 2025 AQA Integration Pipeline — ARPA + ERA5 + Sentinel-5P</footer>
</body>
</html>
